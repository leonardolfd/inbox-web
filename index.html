<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Caixa de Entrada</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    h1 { color: #333; }
    #filtro { margin-bottom: 10px; padding: 5px; }
    select, button { margin: 5px; padding: 5px; }
    .email { background: #fff; margin: 8px 0; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .from { font-weight: bold; }
    .subject { margin: 4px 0; }
    .date { font-size: 0.9em; color: gray; }
  </style>
</head>
<body>
  <h1>Últimos E-mails</h1>

  <input type="text" id="filtro" placeholder="Filtrar por remetente ou assunto" />
  <select id="pasta">
    <option value="INBOX">Inbox</option>
    <option value="Spam">Spam</option>
    <option value="Projetos">Projetos</option>
    <option value="Financeiro">Financeiro</option>
  </select>
  <button onclick="carregarEmails()">Atualizar</button>

  <div id="emails"><p>Carregando...</p></div>

  <script>
    // URL pública do seu backend no Replit
    const API_URL = "https://c32da2d5-0519-4a62-92cb-20b43cfe77a5-00-1er4j7p5c2dco.riker.replit.dev/api/emails";

    async function carregarEmails() {
      const filtro = document.getElementById("filtro").value.toLowerCase();
      const pasta = document.getElementById("pasta").value;
      const div = document.getElementById("emails");
      div.innerHTML = "<p>Carregando...</p>";

      try {
        const resposta = await fetch(`${API_URL}?pasta=${pasta}`);
        const data = await resposta.json();
        div.innerHTML = "";

        const filtrados = data.filter(email =>
          email.remetente.toLowerCase().includes(filtro) ||
          email.assunto.toLowerCase().includes(filtro)
        );

        if (filtrados.length === 0) {
          div.innerHTML = "<p>Nenhum e-mail encontrado.</p>";
        } else {
          filtrados.forEach(email => {
            const bloco = document.createElement("div");
            bloco.className = "email";
            bloco.innerHTML = `
              <div class="from">${email.remetente}</div>
              <div class="subject">${email.assunto}</div>
              <div class="date">${email.data}</div>
            `;
            div.appendChild(bloco);
          });
        }
      } catch (erro) {
        console.error("Erro:", erro);
        div.innerHTML = "<p>Erro ao buscar e-mails.</p>";
      }
    }

    // Carrega automaticamente ao abrir a página
    carregarEmails();
  </script>
</body>
</html>
